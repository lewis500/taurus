{"version":3,"sources":["webpack:///./src/utils.js","webpack:///./src/constants.js","webpack:///./src/models.js","webpack:///./src/reducers/root.js","webpack:///./src/store.js","webpack:///./src/getMFD2.js","webpack:///./src/components/Plot/stylePlot.scss","webpack:///./src/components/Plot/stylePlot.scss?24f5","webpack:///./src/components/Plot/Plot.js","webpack:///./src/components/Plot/index.js","webpack:///./src/components/App/styleApp.scss","webpack:///./src/components/App/styleApp.scss?188b","webpack:///./src/components/App/App.js","webpack:///./src/components/App/index.js","webpack:///./src/index.js"],"names":["createReducer","initialState","handlers","state","arguments","length","undefined","action","hasOwnProperty","type","_moize","__webpack_require__","binder","_moize2","default","fn","_len","args1","Array","_key","_len2","args2","_key2","concat","get","path","split","l","a","i","upo","oldObject","newValues","Object","assign","mod","b","debounce","time","timeout","_this","this","_arguments","console","log","clearTimeout","setTimeout","apply","CYCLE","LANE_LENGTH","N","SJ","VF","W","KJ","TURN","HIST","K0","Q0","GREEN","_constants","_utils","colors","vs","s","getColor","map","d","_materialColors2","makeNode","car","next","prev","moveCar","pos","lane","x","x0","x1","y","y0","y1","id","orientation","alreadyMoved","Lane","direction","_classCallCheck","_a","_slicedToArray","_b","first","last","_uniqueId2","includes","node","temp","Signal","row","col","t","lanesOut","push","range","fill","even","Graph","k","_ref","matrix","signals","_toConsumableArray","cars","lanes","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","Symbol","iterator","done","value","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","_arr","_i","or","addLaneOut","err","return","history","makeCars","q","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","carsPerLane","space","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","newCar","color","nextTimeTurning","Math","random","dt","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","tick","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_step6","_iterator6","_loop","signal","signalOpen","_temp","dx","distanceRemaining","turning","nextLane","find","Error","pop","unshift","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_step7","_iterator7","shift","model","defaultState","timerOn","mfdState","run","payload","getMFDState","_root","store","createStore","_root2","interval","Date","now","subscribe","getState","setInterval","dispatch","clearInterval","table","makeTable","_","kj","qs","min","q0","abs","v","travelTime","timePassedInCycle","g","remainingGreen","max","exports","module","locals","dot","bg","fd","mfd","content","options","hmr","transform","insertInto","_reactRedux","CN","FDLine","_react2","createElement","className","_stylePlot2","MFDLine","MFD","_getMFD2","res","join","connect","_ref2","_ref2$mfdState","plot","width","height","r","main","text","button","svg","ns","ew","inputs","_react","_d3Scale","scale2","scaleLinear","domain","Lanes","_styleApp2","key","CarComponent","_props","props","timerToggle","setK","e","target","kState","qState","onClick","step","onChange","toFixed","_Plot2","_reactDom","container","document","getElementById","render","Provider","_store2","_App2"],"mappings":"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","file":"main.js","sourcesContent":["//@flow\nimport moize from \"moize\";\n\nexport const binder = moize((fn, ...args1) => (...args2) =>\n  fn(...args1, ...args2)\n);\n\nexport const get = (path: string): any => {\n  let split = path.split(\".\");\n  let l = split.length;\n  return a => {\n    for (var i = 0; i < l; i++) a = a[split[i]];\n    return a;\n  };\n};\n\nexport const upo = (oldObject: {}, newValues: {}) =>\n  Object.assign({}, oldObject, newValues);\n\nimport type { Reducer } from \"src/types/Reducer\";\n\nexport function createReducer<S, A: *>(\n  initialState: S,\n  handlers: { [key: string]: Reducer<S, A> }\n): Reducer<S, A> {\n  return function reducer(state: S = initialState, action: A): S {\n    return handlers.hasOwnProperty(action.type)\n      ? handlers[action.type](state, action)\n      : state;\n  };\n}\n\nexport const mod = (a: number, b: number): number => (a % b + b) % b;\n// .mod = function(n) {\n//   return ((this%n)+n)%n;\n// };\n\nexport const debounce = (fn: Function, time: number): Function => {\n  let timeout;\n  // console.log(time);\n\n  return function() {\n    console.log('calling')\n    const functionCall = () => fn.apply(this, arguments);\n\n    clearTimeout(timeout);\n    timeout = setTimeout(functionCall, time);\n  };\n};\n","//@flow\nexport const CYCLE = 30;\nexport const N = 7;\nexport const LANE_LENGTH = 40;\nexport const SJ = 1.5;\nexport const VF = 2;\nexport const W = VF / 2;\nexport const TURN = 0.15;\nexport const HIST = 2*CYCLE;\nexport const KJ = 1 / SJ*LANE_LENGTH;\nexport const K0 = KJ * W / (VF + W);\nexport const Q0 = VF * K0;\nexport const GREEN = CYCLE * 0.5;\n","//@flow\n\nimport { N, CYCLE, LANE_LENGTH, W, SJ, VF, TURN, HIST } from \"src/constants\";\nimport uniqueId from \"lodash/uniqueId\";\nimport { mod } from \"src/utils\";\nimport mc from \"material-colors\";\ntype Orientation = \"ns\" | \"ew\";\ntype Direction = \"n\" | \"s\" | \"e\" | \"w\";\ntype Coord = [number, number];\n\nconst vs = (() => {\n  const a = (VF / W + 1)*SJ,\n    b = W / SJ;\n  return (s: number) => {\n    if (s <= SJ) return 0;\n    else if (s > a) return VF;\n    else return b * (s - SJ);\n  };\n})();\n\nconst getColor = (() => {\n  const colors = [\n    \"red\",\n    \"blue\",\n    \"green\",\n    \"orange\",\n    \"pink\",\n    \"purple\",\n    \"lightBlue\",\n    \"teal\"\n  ].map(d => mc[d][\"200\"]);\n  const l = colors.length - 1;\n  let i = 0;\n  return () => colors[i++ % l];\n})();\n\nexport type Car = {\n  id: string,\n  pos: number,\n  x: number,\n  y: number,\n  lane: string,\n  orientation: Orientation,\n  color: string,\n  nextTimeTurning: boolean,\n  alreadyMoved:boolean\n};\n\ntype Node = {\n  car: Car,\n  next: Node | null,\n  prev: Node | null\n};\n\nconst makeNode = (car): Node => ({ car, next: null, prev: null });\n\nconst makeCar = (pos: number, lane: Lane): Car => {\n  let x = lane.x0 + pos / LANE_LENGTH * (lane.x1 - lane.x0);\n  let y = lane.y0 + pos / LANE_LENGTH * (lane.y1 - lane.y0);\n  return {\n    id: uniqueId(),\n    color: getColor(),\n    pos,\n    x,\n    y,\n    lane: lane.id,\n    orientation: lane.orientation,\n    nextTimeTurning: Math.random() <= TURN,\n    alreadyMoved: false\n  };\n};\n\nconst moveCar = (car: Car, pos: number, lane: Lane): void => {\n  car.x = lane.x0 + pos / LANE_LENGTH * (lane.x1 - lane.x0);\n  car.y = lane.y0 + pos / LANE_LENGTH * (lane.y1 - lane.y0);\n  car.pos = pos;\n  car.lane = lane.id;\n  car.orientation = lane.orientation;\n  car.alreadyMoved = true;\n};\n\nexport class Lane {\n  first: Node | null;\n  last: Node | null;\n  direction: Direction;\n  orientation: Orientation;\n  x0: number;\n  y0: number;\n  x1: number;\n  y1: number;\n  a: Coord;\n  b: Coord;\n  id: string;\n  constructor(a: Coord, b: Coord, direction: Direction) {\n    let [y0, x0] = a;\n    let [y1, x1] = b;\n    if (x1 === 0 && x0 === N - 1) x1 = N;\n    else if (y1 === 0 && y0 === N - 1) y1 = N;\n    else if (y1 === N - 1 && y0 === 0) y0 = N;\n    else if (x1 === N - 1 && x0 === 0) x0 = N;\n    Object.assign(this, {\n      first: null,\n      last: null,\n      direction,\n      a,\n      b,\n      x0,\n      y0,\n      x1,\n      y1,\n      id: uniqueId(),\n      orientation: \"ns\".includes(direction) ? \"ns\" : \"ew\"\n    });\n  }\n\n  unshift(car: Car) {\n    let node = makeNode(car);\n    if (this.first === null) {\n      this.first = this.last = node;\n    } else {\n      let temp = this.first;\n      this.first = node;\n      node.next = temp;\n      temp.prev = node;\n    }\n  }\n\n  push(car: Car) {\n    var node = makeNode(car);\n    if (this.first === null) {\n      this.first = this.last = node;\n    } else {\n      var temp = this.last;\n      this.last = node;\n      node.prev = temp;\n      temp.next = node;\n    }\n  }\n\n  pop(): ?Node {\n    if (this.last === null) {\n      return null;\n    }\n    let temp = this.last;\n    this.last = this.last.prev;\n    if (this.last) this.last.next = null;\n    else this.first = null;\n    return temp;\n  }\n}\n\nexport class Signal {\n  row: number;\n  col: number;\n  orientation: Orientation;\n  t: number;\n  id: string;\n  lanesOut: Array<Lane>;\n  constructor(row: number, col: number) {\n    Object.assign(this, {\n      row,\n      col,\n      orientation: \"ns\",\n      t: 0,\n      id: uniqueId(),\n      lanesOut: []\n    });\n  }\n  addLaneOut(lane: Lane) {\n    this.lanesOut.push(lane);\n  }\n  tick() {\n    this.t = (this.t + 1) % CYCLE;\n    if (this.t > CYCLE / 2) this.orientation = \"ew\";\n    else this.orientation = \"ns\";\n  }\n}\n\nconst range = Array(N)\n  .fill(0)\n  .map((d, i) => i);\n\nconst even = (d: number) => d % 2 === 0;\n\nexport class Graph {\n  matrix: Array<Array<Signal>>;\n  signals: Array<Signal>;\n  lanes: Array<Lane>;\n  cars: Array<Car>;\n  history: Array<[number, number]>;\n  k: number;\n\n  getMFDState(): [number, number] {\n    let l = this.history.length;\n    let k = 0,\n      q = 0;\n    for (let d of this.history) (k += d[0]), (q += d[1]);\n    return [k / l, q / l];\n  }\n\n  makeCars(k: number) {\n    this.k = k;\n    let carsPerLane = k; //distance normalized to lane length\n    this.cars = [];\n    // this.history= [].slice(0,5);\n    let space = LANE_LENGTH / carsPerLane;\n    for (let lane of this.lanes) {\n      lane.first = lane.last = null;\n      for (var i = 0; i < carsPerLane; i++) {\n        let pos = i * space;\n        let newCar = makeCar(pos, lane);\n        lane.push(newCar);\n        this.cars.push(newCar);\n      }\n    }\n  }\n\n  constructor(k: number) {\n    //create signals matrix\n    this.matrix = range.map(row => range.map(col => new Signal(row, col)));\n    this.signals = [].concat(...this.matrix);\n    this.cars = [];\n    this.lanes = [];\n\n    //add lanes\n    for (let row of range)\n      for (let col of range)\n        for (let or of [\"ns\", \"ew\"]) {\n          let direction =\n            or === \"ns\" ? (even(col) ? \"s\" : \"n\") : even(row) ? \"e\" : \"w\";\n          let b =\n            or === \"ns\"\n              ? [mod(even(col) ? row + 1 : row - 1, N), col]\n              : [row, mod(even(row) ? col + 1 : col - 1, N)];\n          let lane = new Lane([row, col], b, direction);\n          this.matrix[row][col].addLaneOut(lane);\n          this.lanes.push(lane);\n        }\n    this.history = [[k, 0]];\n    this.makeCars(k);\n  }\n\n  run(dt: number) {\n    let queue: Array<[Lane, Lane, Car]> = [];\n    for (let signal of this.signals) signal.tick();\n    for(let car of this.cars) car.alreadyMoved = false;\n    let q = 0;\n    for (let lane of this.lanes) {\n      let temp = lane.first;\n      let signal = this.matrix[lane.b[0]][lane.b[1]];\n      let signalOpen = signal.orientation.includes(lane.direction);\n      while (temp) {\n        let { car, next } = temp;\n        let dx = 0;\n        // if(car.alreadyMoved) continue;\n        if (next && !car.alreadyMoved) {\n          dx = vs(next.car.pos - car.pos);\n          moveCar(car, car.pos + dx, lane);\n        }\n        if (!next && !car.alreadyMoved) {\n          let distanceRemaining = LANE_LENGTH - car.pos;\n          if (!signalOpen) {\n            dx = vs(distanceRemaining);\n            moveCar(car, car.pos + dx, lane);\n            // dx=0;\n          } else {\n            let turning = Math.random() < TURN;\n            let nextLane = signal.lanesOut.find(\n              d => (d.orientation === lane.orientation) !== turning\n            );\n            if (!nextLane) throw Error(\"error in finding lane\");\n            if (!nextLane.first) {\n              lane.pop();\n              dx = VF;\n              moveCar(car, VF - distanceRemaining, nextLane);\n              dx = distanceRemaining; //could be a bug\n              nextLane.unshift(car);\n            } else {\n              dx = vs(nextLane.first.car.pos + distanceRemaining);\n              if (dx > distanceRemaining) {\n                lane.pop();\n                moveCar(car, dx - distanceRemaining, nextLane);\n                dx = distanceRemaining;//note this could be a bug\n                // car.nextTimeTurning = Math.random() <= TURN;\n                nextLane.unshift(car);\n              } else {\n                moveCar(car, car.pos + dx, lane);\n              }\n            }\n          }\n        }\n        q += dx;\n        temp = next;\n      }\n    }\n    this.history.push([\n      this.cars.length / this.lanes.length,\n      q / this.lanes.length\n    ]);\n    if (this.history.length > HIST) this.history.shift();\n  }\n}\n","//@flow\nimport { combineReducers } from \"redux\";\n// import { createReducer as CR } from \"src/utils\";\nimport { Graph } from \"src/models\";\n\nlet model = new Graph(10);\n\nconst timerOn = (state, action) =>\n  action.type === \"TIMER_TOGGLE\" ? !state : state;\n\nconst time = (state, action) => {\n  if (action.type === \"TICK\") return state + action.payload;\n  return state;\n};\n\nconst k = (state, action) => {\n  if (action.type === \"SET_K\") return action.payload;\n  return state;\n};\n\nimport type { State } from \"src/types/State\";\nimport type { Action } from \"src/types/Action\";\nimport type { Reducer } from \"src/types/Reducer\";\n\nconst defaultState: State = {\n  time: 0,\n  timerOn: false,\n  signals: model.signals,\n  cars: model.cars,\n  k: 10,\n  mfdState: [0, 0]\n};\n\nconst root: Reducer<State, Action> = (\n  state = defaultState,\n  action: Action\n): State => {\n  if (action.type === \"TICK\")\n    for (var i = 0; i < 1; i++) model.run(action.payload);\n  if (action.type === \"SET_K\") model.makeCars(action.payload);\n\n  return {\n    time: time(state.time, action),\n    timerOn: timerOn(state.timerOn, action),\n    signals: model.signals,\n    cars: model.cars,\n    k: k(state.k, action),\n    mfdState: model.getMFDState()\n  };\n};\nexport default root;\n","import root from \"src/reducers/root\";\nimport type { Action } from \"src/types/Action\";\nimport type { State } from \"src/types/State\";\nimport { createStore } from \"redux\";\nimport type { Store } from \"redux\";\n\nconst store: Store<State, Action> = createStore(root);\n{\n  let interval = null;\n  let last = Date.now();\n\n  store.subscribe(() => {\n    if (store.getState().timerOn && interval === null) {\n      var last = Date.now();\n      interval = setInterval(() => {\n        let now = Date.now();\n        let temp = last;\n        last = now;\n        store.dispatch({\n          type: \"TICK\",\n          payload: (now - temp) / 100\n        });\n      });\n    }\n    if (!store.getState().timerOn && interval !== null) {\n      clearInterval(interval);\n      interval = null;\n    }\n  });\n}\n\nexport default store;\n","//@flow\nimport { VF, Q0, KJ, GREEN, W, CYCLE, LANE_LENGTH as GAP } from \"src/constants\";\nlet kj = KJ / GAP;\nlet q0 = Q0 / GAP;\n\ntype Entry = { q: number, t: number, x: number };\n\nfunction makeTable(direction: \"f\" | \"b\"): Array<Entry> {\n  let table = [];\n  let i = 0;\n  while (true && Math.abs(i) < 20) {\n    let v = i < 0 ? -W : VF;\n    let x = GAP * i;\n    let travelTime = x / v;\n    let timePassedInCycle = travelTime % CYCLE;\n    let g = GREEN - timePassedInCycle;\n    let remainingGreen = Math.max(GREEN - timePassedInCycle, 0);\n    let timeLeftInCycle = CYCLE - timePassedInCycle;\n    let t = travelTime + timeLeftInCycle; //the duration of this entry\n    let q = q0 * remainingGreen + Math.max(0, -x * kj);\n    table.push({ g, t, q, x, travelTime });\n    if (g < 0) break;\n    i = i + (direction === \"f\" ? 1 : -1);\n  }\n  return table;\n}\n\nexport default function createMFD() {\n  let table = [].concat(makeTable(\"f\"), makeTable(\"b\"));\n  console.log(table);\n  let n = 100;\n  return Array(n)\n    .fill(0)\n    .map((_, i) => {\n      let k = i / n * kj;\n      let qs = table\n        .map(({ x, q, t }) => {\n          return (q + x * k) / t;\n        })\n        .concat(VF * k, W * (kj - k));\n      return [k*GAP, Math.min(...qs)*GAP];\n    });\n}\n","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".stylePlot__dot {\\n  fill: #03a9f4;\\n  stroke: white; }\\n\\n.stylePlot__bg {\\n  fill: #616161; }\\n\\n.stylePlot__fd {\\n  fill: none;\\n  stroke: #e91e63; }\\n\\n.stylePlot__mfd {\\n  fill: none;\\n  stroke: #4caf50; }\\n\", \"\"]);\n\n// exports\nexports.locals = {\n\t\"dot\": \"stylePlot__dot\",\n\t\"bg\": \"stylePlot__bg\",\n\t\"fd\": \"stylePlot__fd\",\n\t\"mfd\": \"stylePlot__mfd\"\n};","\nvar content = require(\"!!../../../node_modules/css-loader/index.js?modules&importLoaders=1&localIdentName=[name]__[local]!../../../node_modules/sass-loader/lib/loader.js!./stylePlot.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../node_modules/css-loader/index.js?modules&importLoaders=1&localIdentName=[name]__[local]!../../../node_modules/sass-loader/lib/loader.js!./stylePlot.scss\", function() {\n\t\tvar newContent = require(\"!!../../../node_modules/css-loader/index.js?modules&importLoaders=1&localIdentName=[name]__[local]!../../../node_modules/sass-loader/lib/loader.js!./stylePlot.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","import React from \"react\";\nimport style from \"./stylePlot\";\nimport { connect } from \"react-redux\";\nimport * as CN from \"src/constants\";\nimport getMFD from \"src/getMFD2\";\nconsole.log(CN.Q0);\n\nconst width = 400;\nconst height = 300;\nconst mar = 10;\nconst x = (v: number) => width * v / (CN.LANE_LENGTH / CN.SJ);\nconst y = (v: number) => height * (1 - v / CN.Q0);\n\nconst FDLine = (() => {\n  let K0 = CN.LANE_LENGTH / CN.SJ * CN.W / (CN.VF + CN.W);\n  let d = `M0,${height} L${x(K0)},${y(K0 * CN.VF )} L${width},${height}`;\n  return <path d={d} className={style.fd} />;\n})();\n\nconst MFDLine = (() => {\n  const MFD = getMFD();\n  console.log(MFD);\n  let res = [];\n  for (var i = 0, l = MFD.length; i < l; i++)\n    res.push([x(MFD[i][0]), y(MFD[i][1])]);\n  let d = \"M\" + res.join(\"L\");\n  // console.log(d);\n  return <path d={d} className={style.mfd} />;\n})();\n\nexport default connect(({ mfdState }) => ({ mfdState }))(\n  ({ mfdState: [k, q] }) => {\n    return (\n      <div className={style.plot}>\n        <svg width={width + 2 * mar} height={height + 2 * mar}>\n          <g transform={`translate(${mar},${mar})`}>\n            <rect className={style.bg} width={width} height={height} />\n            {FDLine}\n            {MFDLine}\n            <circle\n              r=\"5\"\n              className={style.dot}\n              transform={`translate(${x(k)},${y(q)})`}\n            />\n          </g>\n        </svg>\n      </div>\n    );\n  }\n);\n","export {default} from './Plot.js'","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"body {\\n  background: #9e9e9e; }\\n\\n.styleApp__main {\\n  padding: 5px; }\\n\\n.styleApp__text {\\n  font-size: 18px; }\\n\\n.styleApp__button {\\n  padding: 5px;\\n  background: white;\\n  color: black;\\n  cursor: pointer;\\n  display: inline-block; }\\n\\n.styleApp__time {\\n  font-size: 18px; }\\n\\n.styleApp__svg {\\n  width: 620px;\\n  height: 620px; }\\n\\n.styleApp__lane {\\n  stroke: #444;\\n  stroke-width: 10px; }\\n\\n.styleApp__signal.styleApp__ns {\\n  fill: #e91e63; }\\n\\n.styleApp__signal.styleApp__ew {\\n  fill: #99d3e7; }\\n\\n.styleApp__car {\\n  fill: #f48fb1; }\\n\\nsvg {\\n  display: inline-block; }\\n\\n.styleApp__inputs span {\\n  padding: 5px; }\\n\\n.styleApp__row {\\n  display: flex; }\\n  .styleApp__row > div {\\n    margin: 5px; }\\n\", \"\"]);\n\n// exports\nexports.locals = {\n\t\"main\": \"styleApp__main\",\n\t\"text\": \"styleApp__text\",\n\t\"button\": \"styleApp__button\",\n\t\"time\": \"styleApp__time\",\n\t\"svg\": \"styleApp__svg\",\n\t\"lane\": \"styleApp__lane\",\n\t\"signal\": \"styleApp__signal\",\n\t\"ns\": \"styleApp__ns\",\n\t\"ew\": \"styleApp__ew\",\n\t\"car\": \"styleApp__car\",\n\t\"inputs\": \"styleApp__inputs\",\n\t\"row\": \"styleApp__row\"\n};","\nvar content = require(\"!!../../../node_modules/css-loader/index.js?modules&importLoaders=1&localIdentName=[name]__[local]!../../../node_modules/sass-loader/lib/loader.js!./styleApp.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../node_modules/css-loader/index.js?modules&importLoaders=1&localIdentName=[name]__[local]!../../../node_modules/sass-loader/lib/loader.js!./styleApp.scss\", function() {\n\t\tvar newContent = require(\"!!../../../node_modules/css-loader/index.js?modules&importLoaders=1&localIdentName=[name]__[local]!../../../node_modules/sass-loader/lib/loader.js!./styleApp.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","//@flow\nimport React, { PureComponent } from \"react\";\nimport { connect } from \"react-redux\";\nimport style from \"./styleApp.scss\";\nimport type { State } from \"src/types/State\";\nimport type { Dispatch } from \"src/types/Dispatch\";\nimport { scaleLinear } from \"d3-scale\";\nimport { N, LANE_LENGTH, SJ } from \"src/constants\";\nimport classnames from \"classnames\";\nimport Plot from \"src/components/Plot\";\nimport { debounce } from \"src/utils\";\n\nconst width = 450;\nconst lineWidth = 5;\nconst scale2 = scaleLinear()\n  .range([0, width])\n  .domain([0, N]);\n\nconst scale = (() => {\n  let a = width / N,\n    b = a - lineWidth,\n    c = lineWidth / 2;\n  return v => {\n    let v0 = v | 0;\n    // if (v0 === v && v0 > 0) return (v0 - 1) * a + c + b;\n    let v1 = v - v0;\n    return v0 * a + v1 * b + c;\n  };\n})();\n\nconst range = Array(2 * N).fill(0);\nconst Lanes = range.map((_, i) => {\n  let d =\n    i < N\n      ? `M0,${scale2(i)} L${width},${scale2(i)}`\n      : `M${scale2(i % N)},0 L${scale2(i % N)},${width}`;\n  return <path d={d} className={style.lane} key={i} />;\n});\n\nclass CarComponent extends PureComponent {\n  render() {\n    let { x, y, orientation, color } = this.props;\n    // if (orientation === \"ns\") (x = scale2(x)), (y = scale(y));\n    // else (x = scale(x)), (y = scale2(y));\n    x = scale2(x);\n    y = scale2(y);\n\n    return (\n      <rect\n        transform={`translate(${x},${y})`}\n        className={style.car}\n        width=\"2\"\n        height=\"2\"\n        x=\"-1\"\n        y=\"-1\"\n      />\n    );\n  }\n}\n\nexport default connect(\n  ({ timerOn, time, cars, k, mfdState }) => ({\n    timerOn,\n    time,\n    cars,\n    k,\n    mfdState\n  }),\n  (dispatch: Dispatch) => ({\n    timerToggle() {\n      dispatch({ type: \"TIMER_TOGGLE\" });\n    },\n    setK(e) {\n      // console.log({...e});\n      let k = +e.target.value;\n      dispatch({ type: \"SET_K\", payload: k });\n    }\n  })\n)(({ timerOn, timerToggle, cars, k, setK, mfdState: [kState, qState] }) => {\n  return (\n    <div className={style.main}>\n      <div className={style.inputs}>\n        <div className={style.button} onClick={timerToggle}>\n          {timerOn ? \"ON\" : \"OFF\"}\n        </div>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max={LANE_LENGTH / SJ - 1}\n          step=\"1\"\n          value={k}\n          onChange={setK}\n        />\n        <span>k: {kState.toFixed(2)}</span>\n        <span>q: {qState.toFixed(2)}</span>\n      </div>\n      <div className={style.row}>\n        <svg className={style.svg}>\n          <g transform=\"translate(10,10)\">\n            {Lanes}\n            <g>\n              {cars.map(d => (\n                <CarComponent\n                  x={d.x}\n                  y={d.y}\n                  key={d.id}\n                  orientation={d.orientation}\n                />\n              ))}\n            </g>\n          </g>\n        </svg>\n        <Plot />\n      </div>\n    </div>\n  );\n});\n","export {default} from './App';","//@flow\nimport React from \"react\";\nimport { Provider } from \"react-redux\";\nimport { render } from \"react-dom\";\nimport App from \"src/components/App\";\nimport store from './store';\n\nconst container = document.getElementById(\"root\");\nif (!container) throw Error(\"no root container\");\n\nrender(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  container\n);\n"],"sourceRoot":""}