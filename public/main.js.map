{"version":3,"sources":["webpack:///./src/constants.js","webpack:///./src/utils.js","webpack:///./src/models.js","webpack:///./src/reducers/root.js","webpack:///./src/store.js","webpack:///./src/getMFD2.js","webpack:///./src/components/Plot/stylePlot.scss","webpack:///./src/components/Plot/stylePlot.scss?24f5","webpack:///./src/components/Plot/Plot.js","webpack:///./src/components/Plot/index.js","webpack:///./src/components/App/styleApp.scss","webpack:///./src/components/App/styleApp.scss?188b","webpack:///./src/components/App/App.js","webpack:///./src/components/App/index.js","webpack:///./src/index.js"],"names":["CYCLE","LANE_LENGTH","N","SJ","VF","W","KJ","TURN","HIST","K0","Q0","GREEN","createReducer","initialState","handlers","state","arguments","length","undefined","action","hasOwnProperty","type","_moize","__webpack_require__","binder","_moize2","default","fn","_len","args1","Array","_key","_len2","args2","_key2","concat","get","path","split","l","a","i","upo","oldObject","newValues","Object","assign","mod","b","_constants","_utils","colors","vs","s","getColor","map","d","_materialColors2","makeNode","car","next","prev","moveCar","pos","lane","x","x0","x1","y","y0","y1","id","orientation","alreadyMoved","Lane","direction","_classCallCheck","this","_a","_slicedToArray","_b","first","last","_uniqueId2","includes","node","temp","Signal","row","col","t","lanesOut","push","range","fill","even","Graph","k","_ref","matrix","signals","apply","_toConsumableArray","cars","lanes","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","Symbol","iterator","done","value","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","_arr","_i","or","addLaneOut","err","return","history","makeCars","q","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","carsPerLane","space","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","newCar","color","nextTimeTurning","Math","random","dt","_this","_iteratorNormalCompletion5","_didIteratorError5","_iteratorError5","_step5","_iterator5","tick","_iteratorNormalCompletion6","_didIteratorError6","_iteratorError6","_step6","_iterator6","_loop","signal","signalOpen","_temp","dx","distanceRemaining","turning","nextLane","find","Error","pop","unshift","_iteratorNormalCompletion7","_didIteratorError7","_iteratorError7","_step7","_iterator7","shift","model","defaultState","time","timerOn","mfdState","run","payload","getMFDState","_root","store","createStore","_root2","interval","Date","now","subscribe","getState","setInterval","dispatch","clearInterval","table","makeTable","console","log","_","kj","qs","min","q0","abs","v","travelTime","timePassedInCycle","g","remainingGreen","max","exports","module","locals","dot","bg","fd","mfd","content","options","hmr","transform","insertInto","_reactRedux","CN","FDLine","_react2","createElement","className","_stylePlot2","MFDLine","MFD","_getMFD2","res","join","connect","_ref2","_ref2$mfdState","plot","width","height","r","main","text","button","svg","ns","ew","inputs","_react","_d3Scale","scale2","scaleLinear","domain","Lanes","_styleApp2","key","CarComponent","_props","props","timerToggle","setK","e","target","kState","qState","onClick","step","onChange","toFixed","_Plot2","_reactDom","container","document","getElementById","render","Provider","_store2","_App2"],"mappings":"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","file":"main.js","sourcesContent":["//@flow\nexport const CYCLE = 30;\nexport const N = 7;\nexport const LANE_LENGTH = 40;\nexport const SJ = 1.5;\nexport const VF = 2;\nexport const W = VF / 2;\nexport const TURN = 0.1;\nexport const HIST = 2*CYCLE;\nexport const KJ = 1 / SJ*LANE_LENGTH;\nexport const K0 = KJ * W / (VF + W);\nexport const Q0 = VF * K0;\nexport const GREEN = CYCLE * 0.5;\n","//@flow\nimport moize from \"moize\";\n\nexport const binder = moize((fn, ...args1) => (...args2) =>\n  fn(...args1, ...args2)\n);\n\nexport const get = (path: string): any => {\n  let split = path.split(\".\");\n  let l = split.length;\n  return a => {\n    for (var i = 0; i < l; i++) a = a[split[i]];\n    return a;\n  };\n};\n\nexport const upo = (oldObject: {}, newValues: {}) =>\n  Object.assign({}, oldObject, newValues);\n\nimport type { Reducer } from \"src/types/Reducer\";\n\nexport function createReducer<S, A: *>(\n  initialState: S,\n  handlers: { [key: string]: Reducer<S, A> }\n): Reducer<S, A> {\n  return function reducer(state: S = initialState, action: A): S {\n    return handlers.hasOwnProperty(action.type)\n      ? handlers[action.type](state, action)\n      : state;\n  };\n}\n\nexport const mod = (a: number, b: number): number => (a % b + b) % b;\n// .mod = function(n) {\n//   return ((this%n)+n)%n;\n// };\n","//@flow\n\nimport { N, CYCLE, LANE_LENGTH, W, SJ, VF, TURN, HIST } from \"src/constants\";\nimport uniqueId from \"lodash/uniqueId\";\nimport { mod } from \"src/utils\";\nimport mc from \"material-colors\";\ntype Orientation = \"ns\" | \"ew\";\ntype Direction = \"n\" | \"s\" | \"e\" | \"w\";\ntype Coord = [number, number];\n\nconst vs = (() => {\n  const a = (VF / W + 1)*SJ,\n    b = W / SJ;\n  return (s: number) => {\n    if (s <= SJ) return 0;\n    else if (s > a) return VF;\n    else return b * (s - SJ);\n  };\n})();\n\nconst getColor = (() => {\n  const colors = [\n    \"red\",\n    \"blue\",\n    \"green\",\n    \"orange\",\n    \"pink\",\n    \"purple\",\n    \"lightBlue\",\n    \"teal\"\n  ].map(d => mc[d][\"200\"]);\n  const l = colors.length - 1;\n  let i = 0;\n  return () => colors[i++ % l];\n})();\n\nexport type Car = {\n  id: string,\n  pos: number,\n  x: number,\n  y: number,\n  lane: string,\n  orientation: Orientation,\n  color: string,\n  nextTimeTurning: boolean,\n  alreadyMoved:boolean\n};\n\ntype Node = {\n  car: Car,\n  next: Node | null,\n  prev: Node | null\n};\n\nconst makeNode = (car): Node => ({ car, next: null, prev: null });\n\nconst makeCar = (pos: number, lane: Lane): Car => {\n  let x = lane.x0 + pos / LANE_LENGTH * (lane.x1 - lane.x0);\n  let y = lane.y0 + pos / LANE_LENGTH * (lane.y1 - lane.y0);\n  return {\n    id: uniqueId(),\n    color: getColor(),\n    pos,\n    x,\n    y,\n    lane: lane.id,\n    orientation: lane.orientation,\n    nextTimeTurning: Math.random() <= TURN,\n    alreadyMoved: false\n  };\n};\n\nconst moveCar = (car: Car, pos: number, lane: Lane): void => {\n  car.x = lane.x0 + pos / LANE_LENGTH * (lane.x1 - lane.x0);\n  car.y = lane.y0 + pos / LANE_LENGTH * (lane.y1 - lane.y0);\n  car.pos = pos;\n  car.lane = lane.id;\n  car.orientation = lane.orientation;\n  car.alreadyMoved = true;\n};\n\nexport class Lane {\n  first: Node | null;\n  last: Node | null;\n  direction: Direction;\n  orientation: Orientation;\n  x0: number;\n  y0: number;\n  x1: number;\n  y1: number;\n  a: Coord;\n  b: Coord;\n  id: string;\n  constructor(a: Coord, b: Coord, direction: Direction) {\n    let [y0, x0] = a;\n    let [y1, x1] = b;\n    if (x1 === 0 && x0 === N - 1) x1 = N;\n    else if (y1 === 0 && y0 === N - 1) y1 = N;\n    else if (y1 === N - 1 && y0 === 0) y0 = N;\n    else if (x1 === N - 1 && x0 === 0) x0 = N;\n    Object.assign(this, {\n      first: null,\n      last: null,\n      direction,\n      a,\n      b,\n      x0,\n      y0,\n      x1,\n      y1,\n      id: uniqueId(),\n      orientation: \"ns\".includes(direction) ? \"ns\" : \"ew\"\n    });\n  }\n\n  unshift(car: Car) {\n    let node = makeNode(car);\n    if (this.first === null) {\n      this.first = this.last = node;\n    } else {\n      let temp = this.first;\n      this.first = node;\n      node.next = temp;\n      temp.prev = node;\n    }\n  }\n\n  push(car: Car) {\n    var node = makeNode(car);\n    if (this.first === null) {\n      this.first = this.last = node;\n    } else {\n      var temp = this.last;\n      this.last = node;\n      node.prev = temp;\n      temp.next = node;\n    }\n  }\n\n  pop(): ?Node {\n    if (this.last === null) {\n      return null;\n    }\n    let temp = this.last;\n    this.last = this.last.prev;\n    if (this.last) this.last.next = null;\n    else this.first = null;\n    return temp;\n  }\n}\n\nexport class Signal {\n  row: number;\n  col: number;\n  orientation: Orientation;\n  t: number;\n  id: string;\n  lanesOut: Array<Lane>;\n  constructor(row: number, col: number) {\n    Object.assign(this, {\n      row,\n      col,\n      orientation: \"ns\",\n      t: 0,\n      id: uniqueId(),\n      lanesOut: []\n    });\n  }\n  addLaneOut(lane: Lane) {\n    this.lanesOut.push(lane);\n  }\n  tick() {\n    this.t = (this.t + 1) % CYCLE;\n    if (this.t > CYCLE / 2) this.orientation = \"ew\";\n    else this.orientation = \"ns\";\n  }\n}\n\nconst range = Array(N)\n  .fill(0)\n  .map((d, i) => i);\n\nconst even = (d: number) => d % 2 === 0;\n\nexport class Graph {\n  matrix: Array<Array<Signal>>;\n  signals: Array<Signal>;\n  lanes: Array<Lane>;\n  cars: Array<Car>;\n  history: Array<[number, number]>;\n  k: number;\n\n  getMFDState(): [number, number] {\n    let l = this.history.length;\n    let k = 0,\n      q = 0;\n    for (let d of this.history) (k += d[0]), (q += d[1]);\n    return [k / l, q / l];\n  }\n\n  makeCars(k: number) {\n    this.k = k;\n    let carsPerLane = k; //distance normalized to lane length\n    this.cars = [];\n    // this.history= [].slice(0,5);\n    let space = LANE_LENGTH / carsPerLane;\n    for (let lane of this.lanes) {\n      lane.first = lane.last = null;\n      for (var i = 0; i < carsPerLane; i++) {\n        let pos = i * space;\n        let newCar = makeCar(pos, lane);\n        lane.push(newCar);\n        this.cars.push(newCar);\n      }\n    }\n  }\n\n  constructor(k: number) {\n    //create signals matrix\n    this.matrix = range.map(row => range.map(col => new Signal(row, col)));\n    this.signals = [].concat(...this.matrix);\n    this.cars = [];\n    this.lanes = [];\n\n    //add lanes\n    for (let row of range)\n      for (let col of range)\n        for (let or of [\"ns\", \"ew\"]) {\n          let direction =\n            or === \"ns\" ? (even(col) ? \"s\" : \"n\") : even(row) ? \"e\" : \"w\";\n          let b =\n            or === \"ns\"\n              ? [mod(even(col) ? row + 1 : row - 1, N), col]\n              : [row, mod(even(row) ? col + 1 : col - 1, N)];\n          let lane = new Lane([row, col], b, direction);\n          this.matrix[row][col].addLaneOut(lane);\n          this.lanes.push(lane);\n        }\n    this.history = [[k, 0]];\n    this.makeCars(k);\n  }\n\n  run(dt: number) {\n    let queue: Array<[Lane, Lane, Car]> = [];\n    for (let signal of this.signals) signal.tick();\n    for(let car of this.cars) car.alreadyMoved = false;\n    let q = 0;\n    for (let lane of this.lanes) {\n      let temp = lane.first;\n      let signal = this.matrix[lane.b[0]][lane.b[1]];\n      let signalOpen = signal.orientation.includes(lane.direction);\n      while (temp) {\n        let { car, next } = temp;\n        let dx = 0;\n        // if(car.alreadyMoved) continue;\n        if (next && !car.alreadyMoved) {\n          dx = vs(next.car.pos - car.pos);\n          moveCar(car, car.pos + dx, lane);\n        }\n        if (!next && !car.alreadyMoved) {\n          let distanceRemaining = LANE_LENGTH - car.pos;\n          if (!signalOpen) {\n            dx = vs(distanceRemaining);\n            moveCar(car, car.pos + dx, lane);\n            // dx=0;\n          } else {\n            let turning = Math.random() < TURN;\n            let nextLane = signal.lanesOut.find(\n              d => (d.orientation === lane.orientation) !== turning\n            );\n            if (!nextLane) throw Error(\"error in finding lane\");\n            if (!nextLane.first) {\n              lane.pop();\n              dx = VF;\n              moveCar(car, VF - distanceRemaining, nextLane);\n              dx = distanceRemaining;\n              nextLane.unshift(car);\n            } else {\n              dx = vs(nextLane.first.car.pos + distanceRemaining);\n              if (dx > distanceRemaining) {\n                lane.pop();\n                moveCar(car, dx - distanceRemaining, nextLane);\n                dx = distanceRemaining;//note this could be a bug\n                // car.nextTimeTurning = Math.random() <= TURN;\n                nextLane.unshift(car);\n              } else {\n                moveCar(car, car.pos + dx, lane);\n              }\n            }\n          }\n        }\n        q += dx;\n        temp = next;\n      }\n    }\n    this.history.push([\n      this.cars.length / this.lanes.length,\n      q / this.lanes.length\n    ]);\n    if (this.history.length > HIST) this.history.shift();\n  }\n}\n","//@flow\nimport { combineReducers } from \"redux\";\n// import { createReducer as CR } from \"src/utils\";\nimport { Graph } from \"src/models\";\n\nlet model = new Graph(10);\n\nconst timerOn = (state, action) =>\n  action.type === \"TIMER_TOGGLE\" ? !state : state;\n\nconst time = (state, action) => {\n  if (action.type === \"TICK\") return state + action.payload;\n  return state;\n};\n\nconst k = (state, action) => {\n  if (action.type === \"SET_K\") return action.payload;\n  return state;\n};\n\nimport type { State } from \"src/types/State\";\nimport type { Action } from \"src/types/Action\";\nimport type { Reducer } from \"src/types/Reducer\";\n\nconst defaultState: State = {\n  time: 0,\n  timerOn: false,\n  signals: model.signals,\n  cars: model.cars,\n  k: 10,\n  mfdState: [0, 0]\n};\n\nconst root: Reducer<State, Action> = (\n  state = defaultState,\n  action: Action\n): State => {\n  if (action.type === \"TICK\")\n    for (var i = 0; i < 3; i++) model.run(action.payload);\n  if (action.type === \"SET_K\") model.makeCars(action.payload);\n\n  return {\n    time: time(state.time, action),\n    timerOn: timerOn(state.timerOn, action),\n    signals: model.signals,\n    cars: model.cars,\n    k: k(state.k, action),\n    mfdState: model.getMFDState()\n  };\n};\nexport default root;\n","import root from \"src/reducers/root\";\nimport type { Action } from \"src/types/Action\";\nimport type { State } from \"src/types/State\";\nimport { createStore } from \"redux\";\nimport type { Store } from \"redux\";\n\nconst store: Store<State, Action> = createStore(root);\n{\n  let interval = null;\n  let last = Date.now();\n\n  store.subscribe(() => {\n    if (store.getState().timerOn && interval === null) {\n      var last = Date.now();\n      interval = setInterval(() => {\n        let now = Date.now();\n        let temp = last;\n        last = now;\n        store.dispatch({\n          type: \"TICK\",\n          payload: (now - temp) / 100\n        });\n      });\n    }\n    if (!store.getState().timerOn && interval !== null) {\n      clearInterval(interval);\n      interval = null;\n    }\n  });\n}\n\nexport default store;\n","//@flow\nimport { VF, Q0, KJ, GREEN, W, CYCLE, LANE_LENGTH as GAP } from \"src/constants\";\nlet kj = KJ / GAP;\nlet q0 = Q0 / GAP;\n\ntype Entry = { q: number, t: number, x: number };\n\nfunction makeTable(direction: \"f\" | \"b\"): Array<Entry> {\n  let table = [];\n  let i = 0;\n  while (true && Math.abs(i) < 20) {\n    let v = i < 0 ? -W : VF;\n    let x = GAP * i;\n    let travelTime = x / v;\n    let timePassedInCycle = travelTime % CYCLE;\n    let g = GREEN - timePassedInCycle;\n    let remainingGreen = Math.max(GREEN - timePassedInCycle, 0);\n    let timeLeftInCycle = CYCLE - timePassedInCycle;\n    let t = travelTime + timeLeftInCycle; //the duration of this entry\n    let q = q0 * remainingGreen + Math.max(0, -x * kj);\n    table.push({ g, t, q, x, travelTime });\n    if (g < 0) break;\n    i = i + (direction === \"f\" ? 1 : -1);\n  }\n  return table;\n}\n\nexport default function createMFD() {\n  let table = [].concat(makeTable(\"f\"), makeTable(\"b\"));\n  console.log(table);\n  let n = 100;\n  return Array(n)\n    .fill(0)\n    .map((_, i) => {\n      let k = i / n * kj;\n      let qs = table\n        .map(({ x, q, t }) => {\n          return (q + x * k) / t;\n        })\n        .concat(VF * k, W * (kj - k));\n      return [k*GAP, Math.min(...qs)*GAP];\n    });\n}\n","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".stylePlot__dot {\\n  fill: #03a9f4;\\n  stroke: white; }\\n\\n.stylePlot__bg {\\n  fill: #616161; }\\n\\n.stylePlot__fd {\\n  fill: none;\\n  stroke: #e91e63; }\\n\\n.stylePlot__mfd {\\n  fill: none;\\n  stroke: #4caf50; }\\n\", \"\"]);\n\n// exports\nexports.locals = {\n\t\"dot\": \"stylePlot__dot\",\n\t\"bg\": \"stylePlot__bg\",\n\t\"fd\": \"stylePlot__fd\",\n\t\"mfd\": \"stylePlot__mfd\"\n};","\nvar content = require(\"!!../../../node_modules/css-loader/index.js?modules&importLoaders=1&localIdentName=[name]__[local]!../../../node_modules/sass-loader/lib/loader.js!./stylePlot.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../node_modules/css-loader/index.js?modules&importLoaders=1&localIdentName=[name]__[local]!../../../node_modules/sass-loader/lib/loader.js!./stylePlot.scss\", function() {\n\t\tvar newContent = require(\"!!../../../node_modules/css-loader/index.js?modules&importLoaders=1&localIdentName=[name]__[local]!../../../node_modules/sass-loader/lib/loader.js!./stylePlot.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","import React from \"react\";\nimport style from \"./stylePlot\";\nimport { connect } from \"react-redux\";\nimport * as CN from \"src/constants\";\nimport getMFD from \"src/getMFD2\";\nconsole.log(CN.Q0);\n\nconst width = 400;\nconst height = 300;\nconst mar = 10;\nconst x = (v: number) => width * v / (CN.LANE_LENGTH / CN.SJ);\nconst y = (v: number) => height * (1 - v / CN.Q0);\n\nconst FDLine = (() => {\n  let K0 = CN.LANE_LENGTH / CN.SJ * CN.W / (CN.VF + CN.W);\n  let d = `M0,${height} L${x(K0)},${y(K0 * CN.VF )} L${width},${height}`;\n  return <path d={d} className={style.fd} />;\n})();\n\nconst MFDLine = (() => {\n  const MFD = getMFD();\n  console.log(MFD);\n  let res = [];\n  for (var i = 0, l = MFD.length; i < l; i++)\n    res.push([x(MFD[i][0]), y(MFD[i][1])]);\n  let d = \"M\" + res.join(\"L\");\n  // console.log(d);\n  return <path d={d} className={style.mfd} />;\n})();\n\nexport default connect(({ mfdState }) => ({ mfdState }))(\n  ({ mfdState: [k, q] }) => {\n    return (\n      <div className={style.plot}>\n        <svg width={width + 2 * mar} height={height + 2 * mar}>\n          <g transform={`translate(${mar},${mar})`}>\n            <rect className={style.bg} width={width} height={height} />\n            {FDLine}\n            {MFDLine}\n            <circle\n              r=\"5\"\n              className={style.dot}\n              transform={`translate(${x(k)},${y(q)})`}\n            />\n          </g>\n        </svg>\n      </div>\n    );\n  }\n);\n","export {default} from './Plot.js'","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"body {\\n  background: #9e9e9e; }\\n\\n.styleApp__main {\\n  padding: 5px; }\\n\\n.styleApp__text {\\n  font-size: 18px; }\\n\\n.styleApp__button {\\n  padding: 5px;\\n  background: white;\\n  color: black;\\n  cursor: pointer;\\n  display: inline-block; }\\n\\n.styleApp__time {\\n  font-size: 18px; }\\n\\n.styleApp__svg {\\n  width: 620px;\\n  height: 620px; }\\n\\n.styleApp__lane {\\n  stroke: #444;\\n  stroke-width: 10px; }\\n\\n.styleApp__signal.styleApp__ns {\\n  fill: #e91e63; }\\n\\n.styleApp__signal.styleApp__ew {\\n  fill: #99d3e7; }\\n\\n.styleApp__car {\\n  fill: #f48fb1; }\\n\\nsvg {\\n  display: inline-block; }\\n\\n.styleApp__inputs span {\\n  padding: 5px; }\\n\\n.styleApp__row {\\n  display: flex; }\\n  .styleApp__row > div {\\n    margin: 5px; }\\n\", \"\"]);\n\n// exports\nexports.locals = {\n\t\"main\": \"styleApp__main\",\n\t\"text\": \"styleApp__text\",\n\t\"button\": \"styleApp__button\",\n\t\"time\": \"styleApp__time\",\n\t\"svg\": \"styleApp__svg\",\n\t\"lane\": \"styleApp__lane\",\n\t\"signal\": \"styleApp__signal\",\n\t\"ns\": \"styleApp__ns\",\n\t\"ew\": \"styleApp__ew\",\n\t\"car\": \"styleApp__car\",\n\t\"inputs\": \"styleApp__inputs\",\n\t\"row\": \"styleApp__row\"\n};","\nvar content = require(\"!!../../../node_modules/css-loader/index.js?modules&importLoaders=1&localIdentName=[name]__[local]!../../../node_modules/sass-loader/lib/loader.js!./styleApp.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../node_modules/css-loader/index.js?modules&importLoaders=1&localIdentName=[name]__[local]!../../../node_modules/sass-loader/lib/loader.js!./styleApp.scss\", function() {\n\t\tvar newContent = require(\"!!../../../node_modules/css-loader/index.js?modules&importLoaders=1&localIdentName=[name]__[local]!../../../node_modules/sass-loader/lib/loader.js!./styleApp.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","//@flow\nimport React, { PureComponent } from \"react\";\nimport { connect } from \"react-redux\";\nimport style from \"./styleApp.scss\";\nimport type { State } from \"src/types/State\";\nimport type { Dispatch } from \"src/types/Dispatch\";\nimport { scaleLinear } from \"d3-scale\";\nimport { N, LANE_LENGTH, SJ } from \"src/constants\";\nimport classnames from \"classnames\";\nimport Plot from \"src/components/Plot\";\n\nconst width = 450;\nconst lineWidth = 5;\nconst scale2 = scaleLinear()\n  .range([0, width])\n  .domain([0, N]);\n\nconst scale = (() => {\n  let a = width / N,\n    b = a - lineWidth,\n    c = lineWidth / 2;\n  return v => {\n    let v0 = v | 0;\n    // if (v0 === v && v0 > 0) return (v0 - 1) * a + c + b;\n    let v1 = v - v0;\n    return v0 * a + v1 * b + c;\n  };\n})();\n\nconst range = Array(2 * N).fill(0);\nconst Lanes = range.map((_, i) => {\n  let d =\n    i < N\n      ? `M0,${scale2(i)} L${width},${scale2(i)}`\n      : `M${scale2(i % N)},0 L${scale2(i % N)},${width}`;\n  return <path d={d} className={style.lane} key={i} />;\n});\n\nclass CarComponent extends PureComponent {\n  render() {\n    let { x, y, orientation, color } = this.props;\n    // if (orientation === \"ns\") (x = scale2(x)), (y = scale(y));\n    // else (x = scale(x)), (y = scale2(y));\n    x = scale2(x);\n    y = scale2(y);\n\n    return (\n      <rect\n        transform={`translate(${x},${y})`}\n        className={style.car}\n        width=\"2\"\n        height=\"2\"\n        x=\"-1\"\n        y=\"-1\"\n      />\n    );\n  }\n}\n\nexport default connect(\n  ({ timerOn, time, cars, k, mfdState }) => ({\n    timerOn,\n    time,\n    cars,\n    k,\n    mfdState\n  }),\n  (dispatch: Dispatch) => ({\n    timerToggle() {\n      dispatch({ type: \"TIMER_TOGGLE\" });\n    },\n    setK(e) {\n      // console.log({...e});\n      let k = +e.target.value;\n      dispatch({ type: \"SET_K\", payload: k });\n    }\n  })\n)(({ timerOn, timerToggle, cars, k, setK, mfdState: [kState, qState] }) => {\n  return (\n    <div className={style.main}>\n      <div className={style.inputs}>\n        <div className={style.button} onClick={timerToggle}>\n          {timerOn ? \"ON\" : \"OFF\"}\n        </div>\n        <input\n          type=\"range\"\n          min=\"0\"\n          max={LANE_LENGTH / SJ - 1}\n          step=\"1\"\n          value={k}\n          // key=\"input\"\n          // onChange={()=>{}}\n          onChange={setK}\n          // onMouseUp={setK}\n        />\n        <span>k: {kState.toFixed(2)}</span>\n        <span>q: {qState.toFixed(2)}</span>\n      </div>\n      <div className={style.row}>\n        <svg className={style.svg}>\n          <g transform=\"translate(10,10)\">\n            {Lanes}\n            <g>\n              {cars.map(d => (\n                <CarComponent\n                  x={d.x}\n                  y={d.y}\n                  key={d.id}\n                  orientation={d.orientation}\n                />\n              ))}\n            </g>\n          </g>\n        </svg>\n        <Plot />\n      </div>\n    </div>\n  );\n});\n","export {default} from './App';","//@flow\nimport React from \"react\";\nimport { Provider } from \"react-redux\";\nimport { render } from \"react-dom\";\nimport App from \"src/components/App\";\nimport store from './store';\n\nconst container = document.getElementById(\"root\");\nif (!container) throw Error(\"no root container\");\n\nrender(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  container\n);\n"],"sourceRoot":""}