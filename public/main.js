(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{20:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mod=e.upo=e.get=e.binder=void 0,e.createReducer=function(t,e){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,r=arguments[1];return e.hasOwnProperty(r.type)?e[r.type](n,r):n}};var r,a=n(17),i=(r=a)&&r.__esModule?r:{default:r};e.binder=(0,i.default)(function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return function(){for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];return t.apply(void 0,n.concat(r))}}),e.get=function(t){var e=t.split("."),n=e.length;return function(t){for(var r=0;r<n;r++)t=t[e[r]];return t}},e.upo=function(t,e){return Object.assign({},t,e)};e.mod=function(t,e){return(t%e+e)%e}},33:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Graph=e.Signal=e.Lane=void 0;var r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,a=!1,i=void 0;try{for(var o,l=t[Symbol.iterator]();!(r=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){a=!0,i=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(7),o=s(n(32)),l=n(20),u=s(n(19));function s(t){return t&&t.__esModule?t:{default:t}}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var c,d,p,y,v,h=(c=i.VF/i.W+1,d=i.W/i.SJ,function(t){return t<i.SJ?0:t>=c?i.VF:d*(t-i.SJ)}),_=(p=["red","blue","green","orange","pink","purple","lightBlue","teal"].map(function(t){return u.default[t][200]}),y=p.length-1,v=0,function(){return p[v++%y]}),m=function(t){return{car:t,next:null,prev:null}},g=function(t,e,n){t.x=n.x0+e/i.LANE_LENGTH*(n.x1-n.x0),t.y=n.y0+e/i.LANE_LENGTH*(n.y1-n.y0),t.pos=e,t.lane=n.id,t.orientation=n.orientation},b=e.Lane=function(){function t(e,n,a){f(this,t);var l=r(e,2),u=l[0],s=l[1],c=r(n,2),d=c[0],p=c[1];0===p&&s===i.N-1?p=i.N:0===d&&u===i.N-1?d=i.N:d===i.N-1&&0===u?u=i.N:p===i.N-1&&0===s&&(s=i.N),Object.assign(this,{first:null,last:null,direction:a,a:e,b:n,x0:s,y0:u,x1:p,y1:d,id:(0,o.default)(),orientation:"ns".includes(a)?"ns":"ew"})}return a(t,[{key:"unshift",value:function(t){var e=m(t);if(null===this.first)this.first=this.last=e;else{var n=this.first;this.first=e,e.next=n,n.prev=e}}},{key:"push",value:function(t){var e=m(t);if(null===this.first)this.first=this.last=e;else{var n=this.last;this.last=e,e.prev=n,n.next=e}}},{key:"pop",value:function(){if(null===this.last)return null;var t=this.last;return this.last=this.last.prev,this.last?this.last.next=null:this.first=null,t}}]),t}(),E=e.Signal=function(){function t(e,n){f(this,t),Object.assign(this,{row:e,col:n,orientation:"ns",t:0,id:(0,o.default)(),lanesOut:[]})}return a(t,[{key:"addLaneOut",value:function(t){this.lanesOut.push(t)}},{key:"tick",value:function(){this.t=(this.t+1)%i.CYCLE,this.t>i.CYCLE/2?this.orientation="ew":this.orientation="ns"}}]),t}(),w=Array(i.N).fill(0).map(function(t,e){return e}),N=function(t){return t%2==0};e.Graph=function(){function t(e){var n;f(this,t),this.matrix=w.map(function(t){return w.map(function(e){return new E(t,e)})}),this.signals=(n=[]).concat.apply(n,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(this.matrix)),this.cars=[],this.lanes=[];var r=!0,a=!1,o=void 0;try{for(var u,s=w[Symbol.iterator]();!(r=(u=s.next()).done);r=!0){var c=u.value,d=!0,p=!1,y=void 0;try{for(var v,h=w[Symbol.iterator]();!(d=(v=h.next()).done);d=!0)for(var _=v.value,m=["ns","ew"],g=0;g<m.length;g++){var x=m[g],A="ns"===x?N(_)?"s":"n":N(c)?"e":"w",O="ns"===x?[(0,l.mod)(N(_)?c+1:c-1,i.N),_]:[c,(0,l.mod)(N(c)?_+1:_-1,i.N)],k=new b([c,_],O,A);this.matrix[c][_].addLaneOut(k),this.lanes.push(k)}}catch(t){p=!0,y=t}finally{try{!d&&h.return&&h.return()}finally{if(p)throw y}}}}catch(t){a=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}this.history=[[e,0]],this.makeCars(e)}return a(t,[{key:"getMFDState",value:function(){var t=this.history.length,e=0,n=0,r=!0,a=!1,i=void 0;try{for(var o,l=this.history[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var u=o.value;e+=u[0],n+=u[1]}}catch(t){a=!0,i=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw i}}return[e/t,n/t]}},{key:"makeCars",value:function(t){this.k=t;var e=t;this.cars=[];var n,r,a,l,u=i.LANE_LENGTH/e,s=!0,f=!1,c=void 0;try{for(var d,p=this.lanes[Symbol.iterator]();!(s=(d=p.next()).done);s=!0){var y=d.value;y.first=y.last=null;for(var v=0;v<e;v++){var h=(n=v*u,void 0,void 0,a=(r=y).x0+n/i.LANE_LENGTH*(r.x1-r.x0),l=r.y0+n/i.LANE_LENGTH*(r.y1-r.y0),{id:(0,o.default)(),color:_(),pos:n,x:a,y:l,lane:r.id,orientation:r.orientation,nextTimeTurning:Math.random()<=i.TURN});y.push(h),this.cars.push(h)}}}catch(t){f=!0,c=t}finally{try{!s&&p.return&&p.return()}finally{if(f)throw c}}}}]),a(t,[{key:"run",value:function(t){var e=this,n=!0,r=!1,a=void 0;try{for(var o,l=this.signals[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){o.value.tick()}}catch(t){r=!0,a=t}finally{try{!n&&l.return&&l.return()}finally{if(r)throw a}}var u=0,s=function(t){for(var n=t.first,r=e.matrix[t.b[0]][t.b[1]],a=r.orientation.includes(t.direction);n;){var o=n,l=o.car,s=o.next,f=0;if(s&&(f=h(s.car.pos-l.pos),g(l,l.pos+f,t)),!s){var c=i.LANE_LENGTH-l.pos;a?function(){var e=Math.random()<i.TURN,n=r.lanesOut.find(function(n){return n.orientation===t.orientation!==e});if(!n)throw Error("error in finding lane");n.first?(f=h(n.first.car.pos+c))>c?(t.pop(),g(l,f-c,n),n.unshift(l)):g(l,l.pos+f,t):(t.pop(),f=i.VF,g(l,i.VF-c,n),n.unshift(l))}():(f=h(c),g(l,l.pos+f,t))}u+=f,n=s}},f=!0,c=!1,d=void 0;try{for(var p,y=this.lanes[Symbol.iterator]();!(f=(p=y.next()).done);f=!0){s(p.value)}}catch(t){c=!0,d=t}finally{try{!f&&y.return&&y.return()}finally{if(c)throw d}}this.history.push([this.k,u/i.N/i.LANE_LENGTH]),this.history.length>i.HIST&&this.history.shift()}}]),t}()},34:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});n(3);var r=new(n(33).Graph)(10),a={time:0,timerOn:!1,signals:r.signals,cars:r.cars,k:10,mfdState:[0,0]};e.default=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,e=arguments[1];if("TICK"===e.type)for(var n=0;n<1;n++)r.run(e.payload);return"SET_K"===e.type&&r.makeCars(e.payload),{time:function(t,e){return"TICK"===e.type?t+e.payload:t}(t.time,e),timerOn:function(t,e){return"TIMER_TOGGLE"===e.type?!t:t}(t.timerOn,e),signals:r.signals,cars:r.cars,k:function(t,e){return"SET_K"===e.type?e.payload:t}(t.k,e),mfdState:r.getMFDState()}}},35:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,a=n(34),i=(r=a)&&r.__esModule?r:{default:r};var o=(0,n(3).createStore)(i.default),l=null;Date.now();o.subscribe(function(){if(o.getState().timerOn&&null===l){var t=Date.now();l=setInterval(function(){var e=Date.now(),n=t;t=e,o.dispatch({type:"TICK",payload:(e-n)/100})})}o.getState().timerOn||null===l||(clearInterval(l),l=null)}),e.default=o},36:function(t,e,n){(e=t.exports=n(12)(!1)).push([t.i,".stylePlot__dot {\n  fill: #03a9f4;\n  stroke: white; }\n\n.stylePlot__bg {\n  fill: #616161; }\n\n.stylePlot__fd {\n  fill: none;\n  stroke: #e91e63; }\n",""]),e.locals={dot:"stylePlot__dot",bg:"stylePlot__bg",fd:"stylePlot__fd"}},37:function(t,e,n){var r=n(36);"string"==typeof r&&(r=[[t.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(11)(r,a);r.locals&&(t.exports=r.locals)},38:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,a=!1,i=void 0;try{for(var o,l=t[Symbol.iterator]();!(r=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){a=!0,i=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=u(n(1)),i=u(n(37)),o=n(5),l=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(7));function u(t){return t&&t.__esModule?t:{default:t}}var s,f,c=function(t){return 400*t/(l.LANE_LENGTH/l.SJ)},d=function(t){return 300*(1-t/6)},p=(s=l.LANE_LENGTH/l.SJ*l.W/(l.VF+l.W),f="M0,300 L"+c(s)+","+d(s*l.VF/2)+" L400,300",a.default.createElement("path",{d:f,className:i.default.fd}));e.default=(0,o.connect)(function(t){return{mfdState:t.mfdState}})(function(t){var e=r(t.mfdState,2),n=e[0],o=e[1];return a.default.createElement("div",{className:i.default.plot},a.default.createElement("svg",{width:420,height:320},a.default.createElement("g",{transform:"translate(10,10)"},a.default.createElement("rect",{className:i.default.bg,width:400,height:300}),p,a.default.createElement("circle",{r:"5",className:i.default.dot,transform:"translate("+c(n)+","+d(o)+")"}))))})},39:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(38);Object.defineProperty(e,"default",{enumerable:!0,get:function(){return(t=r,t&&t.__esModule?t:{default:t}).default;var t}})},42:function(t,e,n){(e=t.exports=n(12)(!1)).push([t.i,"body {\n  background: #9e9e9e; }\n\n.styleApp__main {\n  padding: 5px; }\n\n.styleApp__text {\n  font-size: 18px; }\n\n.styleApp__button {\n  padding: 5px;\n  background: white;\n  color: black;\n  cursor: pointer;\n  display: inline-block; }\n\n.styleApp__time {\n  font-size: 18px; }\n\n.styleApp__svg {\n  width: 620px;\n  height: 620px; }\n\n.styleApp__lane {\n  stroke: #444;\n  stroke-width: 10px; }\n\n.styleApp__signal.styleApp__ns {\n  fill: #e91e63; }\n\n.styleApp__signal.styleApp__ew {\n  fill: #99d3e7; }\n\n.styleApp__car {\n  fill: #f48fb1; }\n\nsvg {\n  display: inline-block; }\n\n.styleApp__inputs span {\n  padding: 5px; }\n\n.styleApp__row {\n  display: flex; }\n  .styleApp__row > div {\n    margin: 5px; }\n",""]),e.locals={main:"styleApp__main",text:"styleApp__text",button:"styleApp__button",time:"styleApp__time",svg:"styleApp__svg",lane:"styleApp__lane",signal:"styleApp__signal",ns:"styleApp__ns",ew:"styleApp__ew",car:"styleApp__car",inputs:"styleApp__inputs",row:"styleApp__row"}},43:function(t,e,n){var r=n(42);"string"==typeof r&&(r=[[t.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(11)(r,a);r.locals&&(t.exports=r.locals)},44:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,a=!1,i=void 0;try{for(var o,l=t[Symbol.iterator]();!(r=(o=l.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){a=!0,i=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(1),o=d(i),l=n(5),u=d(n(43)),s=n(18),f=n(7),c=(d(n(40)),d(n(39)));function d(t){return t&&t.__esModule?t:{default:t}}var p,y,v=(0,s.scaleLinear)().range([0,450]).domain([0,f.N]),h=(p=450/f.N,y=p-5,Array(2*f.N).fill(0).map(function(t,e){var n=e<f.N?"M0,"+v(e)+" L450,"+v(e):"M"+v(e%f.N)+",0 L"+v(e%f.N)+",450";return o.default.createElement("path",{d:n,className:u.default.lane,key:e})})),_=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.PureComponent),a(e,[{key:"render",value:function(){var t=this.props,e=t.x,n=t.y;t.orientation,t.color;return e=v(e),n=v(n),o.default.createElement("rect",{transform:"translate("+e+","+n+")",className:u.default.car,width:"2",height:"2",x:"-1",y:"-1"})}}]),e}();e.default=(0,l.connect)(function(t){return{timerOn:t.timerOn,time:t.time,cars:t.cars,k:t.k,mfdState:t.mfdState}},function(t){return{timerToggle:function(){t({type:"TIMER_TOGGLE"})},setK:function(e){var n=+e.target.value;t({type:"SET_K",payload:n})}}})(function(t){var e=t.timerOn,n=t.timerToggle,a=t.cars,i=t.k,l=t.setK,s=r(t.mfdState,2),d=s[0],p=s[1];return o.default.createElement("div",{className:u.default.main},o.default.createElement("div",{className:u.default.inputs},o.default.createElement("div",{className:u.default.button,onClick:n},e?"ON":"OFF"),o.default.createElement("input",{type:"range",min:"0",max:f.LANE_LENGTH/f.SJ-1,step:"1",value:i,onChange:l}),o.default.createElement("span",null,"k: ",d.toFixed(2)),o.default.createElement("span",null,"q: ",p.toFixed(2))),o.default.createElement("div",{className:u.default.row},o.default.createElement("svg",{className:u.default.svg},o.default.createElement("g",{transform:"translate(10,10)"},h,o.default.createElement("g",null,a.map(function(t){return o.default.createElement(_,{x:t.x,y:t.y,key:t.id,orientation:t.orientation})})))),o.default.createElement(c.default,null)))})},45:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(44);Object.defineProperty(e,"default",{enumerable:!0,get:function(){return(t=r,t&&t.__esModule?t:{default:t}).default;var t}})},61:function(t,e,n){"use strict";var r=u(n(1)),a=n(5),i=n(55),o=u(n(45)),l=u(n(35));function u(t){return t&&t.__esModule?t:{default:t}}var s=document.getElementById("root");if(!s)throw Error("no root container");(0,i.render)(r.default.createElement(a.Provider,{store:l.default},r.default.createElement(o.default,null)),s)},7:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.CYCLE=10,e.N=7,e.LANE_LENGTH=40,e.SJ=1.25;var r=e.VF=2;e.W=r/2,e.TURN=.3,e.HIST=30}},[[61,0,1]]]);
//# sourceMappingURL=main.js.map